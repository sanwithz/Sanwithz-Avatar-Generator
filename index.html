<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sanwithz Avatar Lab</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&family=Prompt:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Noto Sans Thai', 'Prompt', sans-serif;
      margin: 0;
      padding: 0;
      user-select: none;
    }
    
    * {
      box-sizing: border-box;
    }

    .font-prompt {
      font-family: 'Prompt', sans-serif;
    }

    .glass-morphism {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .color-swatch {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .color-swatch:hover {
      transform: scale(1.05);
    }

    .color-swatch.active {
      border-color: #10b981;
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
    }

    .bg-checkerboard {
      background-image: linear-gradient(45deg, #e5e7eb 25%, transparent 25%), 
                        linear-gradient(-45deg, #e5e7eb 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #e5e7eb 75%), 
                        linear-gradient(-45deg, transparent 75%, #e5e7eb 75%);
      background-size: 10px 10px;
      background-position: 0 0, 0 5px, 5px -5px, -5px 0px;
      background-color: white;
    }

    .style-card {
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }

    .style-card.active {
      border-color: #10b981;
      background: rgba(16, 185, 129, 0.05);
    }

    .blur-decoration {
      position: absolute;
      border-radius: 50%;
      filter: blur(100px);
      opacity: 0.15;
      pointer-events: none;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .spinner {
      animation: spin 1s linear infinite;
    }

    input[type=range] {
      -webkit-appearance: none;
      background: transparent;
    }

    input[type=range]::-webkit-slider-runnable-track {
      width: 100%;
      height: 8px;
      background: #f1f5f9;
      border-radius: 10px;
    }

    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 20px;
      width: 20px;
      border-radius: 50%;
      background: #10b981;
      cursor: grab;
      margin-top: -6px;
      border: 3px solid white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    input[type=range]:active::-webkit-slider-thumb {
      cursor: grabbing;
      transform: scale(1.1);
    }

    .avatar-preview-container {
      cursor: grab;
      touch-action: none;
    }

    .avatar-preview-container:active {
      cursor: grabbing;
    }

    .shuffle-btn-main {
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .shuffle-btn-main:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body class="h-full bg-slate-50">
  <div id="root" class="h-full w-full overflow-auto"></div>

  <script type="module">
    // Configuration
    const config = {
      app_title: "Sanwithz Avatar Lab",
      background_color: "#f8fafc",
      primary_color: "#10b981",
      text_color: "#1e293b",
      surface_color: "#ffffff",
      accent_color: "#3b82f6"
    };

    const avatarStyles = [
      { id: 'adventurer', name: 'Adventurer' },
      { id: 'avataaars', name: 'Avataaars' },
      { id: 'notionists', name: 'Notionists' },
      { id: 'bottts', name: 'Bottts' },
      { id: 'fun-emoji', name: 'Fun Emoji' },
      { id: 'lorelei', name: 'Lorelei' },
      { id: 'open-peeps', name: 'Open Peeps' },
      { id: 'pixel-art', name: 'Pixel Art' },
      { id: 'big-smile', name: 'Big Smile' },
      { id: 'croodles', name: 'Croodles' }
    ];

    const backgroundColors = [
      { id: 'transparent', color: 'transparent', label: 'Transparent' },
      { id: 'emerald', color: '#10b981', label: 'Emerald' },
      { id: 'blue', color: '#3b82f6', label: 'Blue' },
      { id: 'purple', color: '#8b5cf6', label: 'Purple' },
      { id: 'pink', color: '#ec4899', label: 'Pink' },
      { id: 'orange', color: '#f59e0b', label: 'Orange' },
      { id: 'slate', color: '#64748b', label: 'Slate' },
      { id: 'red', color: '#ef4444', label: 'Red' }
    ];

    let state = {
      selectedStyle: 'avataaars',
      seed: 'Sanwithz',
      rotation: 0,
      scale: 100,
      flip: false,
      backgroundColor: 'transparent',
      isDownloading: false,
      mobileMenuOpen: false
    };

    let isDragging = false;
    let startX = 0;
    let startRotation = 0;

    function generateRandomSeed() {
      return Math.random().toString(36).substring(2, 12);
    }

    function getAvatarUrl(format = 'svg') {
      const bgColor = state.backgroundColor === 'transparent' ? '' : `&backgroundColor=${state.backgroundColor.replace('#', '')}`;
      // Use PNG for download, SVG for crisp preview
      return `https://api.dicebear.com/9.x/${state.selectedStyle}/${format}?seed=${encodeURIComponent(state.seed)}${bgColor}&size=512`;
    }

    async function downloadAvatar() {
      state.isDownloading = true;
      render();
      try {
        // Download as PNG by default
        const pngUrl = getAvatarUrl('png');
        const response = await fetch(pngUrl);
        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `avatar-${state.seed}.png`;
        a.click();
        URL.revokeObjectURL(url);
        showToast('‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå PNG ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', 'success');
      } catch (error) {
        showToast('‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
      } finally {
        state.isDownloading = false;
        render();
      }
    }

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      const bgColor = type === 'success' ? 'bg-emerald-500' : type === 'error' ? 'bg-red-500' : 'bg-slate-800';
      toast.className = `fixed bottom-24 left-1/2 -translate-x-1/2 md:bottom-10 md:right-10 md:left-auto md:translate-x-0 ${bgColor} text-white px-6 py-3 rounded-2xl shadow-xl z-[100] transition-all duration-300 transform translate-y-0 opacity-100 font-medium`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(10px)';
        setTimeout(() => document.body.removeChild(toast), 300);
      }, 3000);
    }

    function handleDragStart(e) {
      isDragging = true;
      startX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
      startRotation = state.rotation;
    }

    function handleDragMove(e) {
      if (!isDragging) return;
      const currentX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
      const deltaX = currentX - startX;
      const newRotation = (startRotation + deltaX * 0.8) % 360;
      state.rotation = Math.round(newRotation < 0 ? 360 + newRotation : newRotation);
      
      const img = document.querySelector('#avatar-preview-img');
      const rotValue = document.querySelector('#rotation-value');
      const rotSlider = document.querySelector('#rotation-slider');
      
      if (img) img.style.transform = `rotate(${state.rotation}deg) scale(${state.scale / 100}) ${state.flip ? 'scaleX(-1)' : ''}`;
      if (rotValue) rotValue.textContent = `${state.rotation}¬∞`;
      if (rotSlider) rotSlider.value = state.rotation;
    }

    function handleDragEnd() {
      isDragging = false;
    }

    window.addEventListener('mousemove', handleDragMove);
    window.addEventListener('touchmove', handleDragMove, { passive: false });
    window.addEventListener('mouseup', handleDragEnd);
    window.addEventListener('touchend', handleDragEnd);

    function render() {
      const avatarTransform = `rotate(${state.rotation}deg) scale(${state.scale / 100}) ${state.flip ? 'scaleX(-1)' : ''}`;

      document.getElementById('root').innerHTML = `
        <div class="h-full w-full flex flex-col relative overflow-hidden" style="background-color: ${config.background_color};">
          <div class="blur-decoration w-80 h-80 top-[-10%] left-[-10%]" style="background: ${config.primary_color};"></div>
          <div class="blur-decoration w-80 h-80 bottom-[-10%] right-[-10%]" style="background: ${config.accent_color};"></div>

          <header class="glass-morphism sticky top-0 z-40 px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-xl flex items-center justify-center shadow-lg" style="background: ${config.primary_color};">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
              </div>
              <h1 class="font-prompt text-xl font-bold text-slate-800">${config.app_title}</h1>
            </div>
            <button onclick="window.appFunctions.downloadAvatar()" 
                    class="hidden md:flex items-center gap-2 px-6 py-2.5 rounded-xl font-bold transition-all hover:scale-105 active:scale-95 shadow-md ${state.isDownloading ? 'opacity-50' : ''}"
                    style="background: ${config.primary_color}; color: white;">
              ${state.isDownloading ? '<svg class="w-5 h-5 spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 4V1m0 22v-3"/></svg>' : '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>'}
              <span>Download PNG</span>
            </button>
          </header>

          <div class="flex-1 flex flex-col md:flex-row overflow-hidden">
            <aside class="hidden md:block w-80 overflow-y-auto p-6 border-r border-slate-200 shadow-sm" style="background: white;">
              ${renderSidebar()}
            </aside>

            <main class="flex-1 flex flex-col items-center justify-center p-6 bg-slate-50/30">
              <div class="relative group">
                <div class="avatar-preview-container bg-white rounded-[3rem] p-10 shadow-2xl transition-all duration-500 group-hover:shadow-emerald-200/50"
                     onmousedown="window.appFunctions.handleDragStart(event)"
                     ontouchstart="window.appFunctions.handleDragStart(event)">
                  <div class="w-64 h-64 md:w-80 md:h-80 rounded-[2rem] overflow-hidden flex items-center justify-center pointer-events-none" 
                       style="background: ${state.backgroundColor === 'transparent' ? '#f8fafc' : state.backgroundColor}; ${state.backgroundColor === 'transparent' ? 'background-image: radial-gradient(#e2e8f0 1px, transparent 1px); background-size: 20px 20px;' : ''}">
                    <img id="avatar-preview-img" src="${getAvatarUrl('svg')}" class="w-full h-full transition-transform duration-75 ease-out" style="transform: ${avatarTransform};" />
                  </div>
                </div>
                
                <div class="mt-8 text-center flex flex-col gap-2">
                  <span class="px-4 py-1.5 rounded-full bg-slate-100 text-slate-500 font-mono text-sm font-bold border border-slate-200 shadow-sm">
                    ID: ${state.seed}
                  </span>
                  <p class="text-xs text-slate-400 font-medium md:hidden">üí° Tip: ‡∏•‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß Avatar ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏∏‡∏ô</p>
                </div>
              </div>

              <div class="mt-8 hidden md:block">
                 <p class="text-sm font-medium text-slate-400">üí° Tip: Drag on the avatar to rotate</p>
              </div>
            </main>
          </div>

          <!-- Mobile Controls Overlay -->
          ${state.mobileMenuOpen ? `
            <div class="fixed inset-0 z-[60] bg-slate-900/60 backdrop-blur-sm md:hidden" onclick="window.appFunctions.toggleMobileMenu()">
              <div class="absolute bottom-0 left-0 right-0 max-h-[85vh] overflow-y-auto rounded-t-[3rem] p-8 shadow-2xl animate-slide-up" 
                   style="background: white;" onclick="event.stopPropagation()">
                <div class="w-16 h-1.5 bg-slate-200 rounded-full mx-auto mb-8"></div>
                ${renderSidebar()}
                <div class="h-12"></div>
              </div>
            </div>
          ` : `
            <div class="md:hidden fixed bottom-6 left-6 right-6 z-50 flex gap-3">
              <button onclick="window.appFunctions.toggleMobileMenu()" 
                      class="flex-1 py-4 rounded-2xl shadow-xl flex items-center justify-center gap-3 font-bold text-lg transition-transform active:scale-95"
                      style="background: white; color: ${config.text_color}; border: 1px solid #e2e8f0;">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4v2"/></svg>
                Customize
              </button>
              <button onclick="window.appFunctions.downloadAvatar()" 
                      class="w-16 h-16 rounded-2xl shadow-xl flex items-center justify-center transition-transform active:scale-95"
                      style="background: ${config.primary_color}; color: white;">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
              </button>
            </div>
          `}
        </div>
      `;
    }

    function renderSidebar() {
      return `
        <div class="space-y-8">
          <!-- Seed Identity Section (Re-styled for prominence) -->
          <div class="space-y-4 p-5 rounded-[2rem] bg-emerald-50 border border-emerald-100 shadow-sm">
            <h2 class="font-prompt text-emerald-900 font-bold flex items-center gap-2 text-lg">
               <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
               Seed Identity
            </h2>
            
            <div class="space-y-3">
              <input type="text" value="${state.seed}" oninput="window.appFunctions.updateSeed(this.value)"
                     placeholder="Enter seed name..."
                     class="w-full px-5 py-4 rounded-2xl bg-white border border-emerald-200 font-mono text-base font-bold text-emerald-700 focus:outline-none focus:ring-4 ring-emerald-500/10 focus:border-emerald-500 transition-all shadow-inner" />
              
              <button onclick="window.appFunctions.randomizeSeed()" 
                      class="shuffle-btn-main w-full py-4 rounded-2xl bg-emerald-600 hover:bg-emerald-700 text-white font-black text-lg flex items-center justify-center gap-3 shadow-lg shadow-emerald-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 00-3.7-3.7 48.678 48.678 0 00-7.324 0 4.006 4.006 0 00-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3l-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 003.7 3.7 48.656 48.656 0 007.324 0 4.006 4.006 0 003.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3l-3 3" />
                </svg>
                SHUFFLE SEED
              </button>
            </div>
          </div>

          <!-- Styles -->
          <div class="space-y-4">
            <h2 class="font-prompt text-slate-800 font-bold flex items-center gap-2 text-lg">
               <span class="w-1.5 h-6 rounded-full" style="background: ${config.primary_color}"></span>
               Avatar Style
            </h2>
            <div class="grid grid-cols-2 gap-2.5">
              ${avatarStyles.map(style => `
                <button onclick="window.appFunctions.setStyle('${style.id}')"
                        class="style-card p-3.5 rounded-2xl text-xs font-bold transition-all ${state.selectedStyle === style.id ? 'active' : 'bg-slate-50 text-slate-500 border-slate-100'}">
                  ${style.name}
                </button>
              `).join('')}
            </div>
          </div>

          <!-- Adjustments -->
          <div class="space-y-6">
            <h2 class="font-prompt text-slate-800 font-bold flex items-center gap-2 text-lg">
               <span class="w-1.5 h-6 rounded-full" style="background: ${config.primary_color}"></span>
               Adjustments
            </h2>
            
            <div class="space-y-3">
              <div class="flex justify-between items-end">
                <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Rotation</span>
                <span id="rotation-value" class="text-sm font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-md">${state.rotation}¬∞</span>
              </div>
              <input id="rotation-slider" type="range" min="0" max="360" value="${state.rotation}" 
                     oninput="window.appFunctions.setRotation(this.value)" 
                     class="w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer" />
            </div>

            <div class="space-y-3">
              <div class="flex justify-between items-end">
                <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Scale</span>
                <span class="text-sm font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-md">${state.scale}%</span>
              </div>
              <input type="range" min="50" max="150" value="${state.scale}" 
                     oninput="window.appFunctions.setScale(this.value)" 
                     class="w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer" />
            </div>

            <div class="flex items-center justify-between p-3 rounded-2xl bg-slate-50 border border-slate-100">
              <span class="text-sm font-bold text-slate-700">Mirror Avatar</span>
              <button onclick="window.appFunctions.toggleFlip()" class="w-12 h-6 rounded-full transition-colors relative ${state.flip ? 'bg-emerald-500' : 'bg-slate-300'}">
                <div class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform ${state.flip ? 'translate-x-6' : ''}"></div>
              </button>
            </div>
          </div>

          <!-- Backgrounds -->
          <div class="space-y-4">
            <h2 class="font-prompt text-slate-800 font-bold flex items-center gap-2 text-lg">
               <span class="w-1.5 h-6 rounded-full" style="background: ${config.primary_color}"></span>
               Background
            </h2>
            <div class="flex flex-wrap gap-2.5">
              ${backgroundColors.map(bg => `
                <button onclick="window.appFunctions.setBackground('${bg.color}')"
                        class="color-swatch ${state.backgroundColor === bg.color ? 'active' : ''} ${bg.color === 'transparent' ? 'bg-checkerboard' : ''}"
                        style="${bg.color !== 'transparent' ? `background-color: ${bg.color};` : ''}"
                        title="${bg.label}">
                  ${bg.color === 'transparent' ? `
                    <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/></svg>
                  ` : ''}
                </button>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    // Global Action Functions
    window.appFunctions = {
      setStyle: (id) => { state.selectedStyle = id; render(); },
      updateSeed: (val) => { state.seed = val; render(); },
      randomizeSeed: () => { state.seed = generateRandomSeed(); render(); },
      setRotation: (val) => { state.rotation = parseInt(val); render(); },
      setScale: (val) => { state.scale = parseInt(val); render(); },
      toggleFlip: () => { state.flip = !state.flip; render(); },
      setBackground: (color) => { state.backgroundColor = color; render(); },
      handleDragStart,
      downloadAvatar,
      toggleMobileMenu: () => { state.mobileMenuOpen = !state.mobileMenuOpen; render(); }
    };

    render();
  </script>
</body>
</html>
